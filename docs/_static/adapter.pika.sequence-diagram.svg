<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="998px" preserveAspectRatio="none" style="width:1167px;height:998px;background:#FFFFFF;" version="1.1" viewBox="0 0 1167 998" width="1167px" zoomAndPan="magnify"><defs><filter height="300%" id="f12l3ty6aggeyv" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f12l3ty6aggeyv)" height="115.2422" style="stroke:#000000;stroke-width:2.0;" width="531.5" x="30" y="202.7305"/><rect fill="#FFFFFF" filter="url(#f12l3ty6aggeyv)" height="562.5449" style="stroke:#000000;stroke-width:2.0;" width="1140" x="10" y="375.2832"/><rect fill="#FFFFFF" filter="url(#f12l3ty6aggeyv)" height="384.6816" style="stroke:#000000;stroke-width:2.0;" width="1120" x="20" y="546.1465"/><rect fill="#FFFFFF" height="250.1289" style="stroke:none;stroke-width:1.0;" width="1120" x="20" y="680.6992"/><rect fill="#FFFFFF" filter="url(#f12l3ty6aggeyv)" height="120.2422" style="stroke:#000000;stroke-width:2.0;" width="705" x="30" y="803.5859"/><rect fill="#FFFFFF" height="44.3105" style="stroke:none;stroke-width:1.0;" width="705" x="30" y="879.5176"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="83" x2="83" y1="40.4883" y2="954.8281"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="228" x2="228" y1="40.4883" y2="954.8281"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="352" x2="352" y1="40.4883" y2="954.8281"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="485" x2="485" y1="40.4883" y2="954.8281"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="632.5" x2="632.5" y1="40.4883" y2="954.8281"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="791" x2="791" y1="40.4883" y2="954.8281"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="989" x2="989" y1="40.4883" y2="954.8281"/><path d="M45,14 L122,14 C127,14 127,27.2441 127,27.2441 C127,27.2441 127,40.4883 122,40.4883 L45,40.4883 C40,40.4883 40,27.2441 40,27.2441 C40,27.2441 40,14 45,14 " fill="#FEFECE" filter="url(#f12l3ty6aggeyv)" style="stroke:#A80036;stroke-width:2.0;"/><path d="M122,14 C117,14 117,27.2441 117,27.2441 C117,40.4883 122,40.4883 122,40.4883 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="45" y="32.5352">RabbitMQ</text><path d="M45,953.8281 L122,953.8281 C127,953.8281 127,967.0723 127,967.0723 C127,967.0723 127,980.3164 122,980.3164 L45,980.3164 C40,980.3164 40,967.0723 40,967.0723 C40,967.0723 40,953.8281 45,953.8281 " fill="#FEFECE" filter="url(#f12l3ty6aggeyv)" style="stroke:#A80036;stroke-width:2.0;"/><path d="M122,953.8281 C117,953.8281 117,967.0723 117,967.0723 C117,980.3164 122,980.3164 122,980.3164 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="45" y="972.3633">RabbitMQ</text><rect fill="#FEFECE" filter="url(#f12l3ty6aggeyv)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="85" x="184" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="191" y="25.5352">Consumer</text><rect fill="#FEFECE" filter="url(#f12l3ty6aggeyv)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="85" x="184" y="953.8281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="191" y="974.3633">Consumer</text><rect fill="#FEFECE" filter="url(#f12l3ty6aggeyv)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="134" x="283" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="290" y="25.5352">threading.Thread</text><rect fill="#FEFECE" filter="url(#f12l3ty6aggeyv)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="134" x="283" y="953.8281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="290" y="974.3633">threading.Thread</text><path d="M436,14 L534,14 C539,14 539,27.2441 539,27.2441 C539,27.2441 539,40.4883 534,40.4883 L436,40.4883 C431,40.4883 431,27.2441 431,27.2441 C431,27.2441 431,14 436,14 " fill="#FEFECE" filter="url(#f12l3ty6aggeyv)" style="stroke:#A80036;stroke-width:2.0;"/><path d="M534,14 C529,14 529,27.2441 529,27.2441 C529,40.4883 534,40.4883 534,40.4883 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="436" y="32.5352">Internal FIFO</text><path d="M436,953.8281 L534,953.8281 C539,953.8281 539,967.0723 539,967.0723 C539,967.0723 539,980.3164 534,980.3164 L436,980.3164 C431,980.3164 431,967.0723 431,967.0723 C431,967.0723 431,953.8281 436,953.8281 " fill="#FEFECE" filter="url(#f12l3ty6aggeyv)" style="stroke:#A80036;stroke-width:2.0;"/><path d="M534,953.8281 C529,953.8281 529,967.0723 529,967.0723 C529,980.3164 534,980.3164 534,980.3164 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="436" y="972.3633">Internal FIFO</text><rect fill="#FEFECE" filter="url(#f12l3ty6aggeyv)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="65" x="598.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="605.5" y="25.5352">Receive</text><rect fill="#FEFECE" filter="url(#f12l3ty6aggeyv)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="65" x="598.5" y="953.8281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="605.5" y="974.3633">Receive</text><rect fill="#FEFECE" filter="url(#f12l3ty6aggeyv)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="92" x="743" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78" x="750" y="25.5352">Application</text><rect fill="#FEFECE" filter="url(#f12l3ty6aggeyv)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="92" x="743" y="953.8281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78" x="750" y="974.3633">Application</text><rect fill="#FEFECE" filter="url(#f12l3ty6aggeyv)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="277" x="849" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="263" x="856" y="25.5352">md.message.MessageHandlerInterface</text><rect fill="#FEFECE" filter="url(#f12l3ty6aggeyv)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="277" x="849" y="953.8281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="263" x="856" y="974.3633">md.message.MessageHandlerInterface</text><rect fill="#EEEEEE" filter="url(#f12l3ty6aggeyv)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1160" x="0" y="71.1436"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1160" y1="71.1436" y2="71.1436"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1160" y1="74.1436" y2="74.1436"/><rect fill="#EEEEEE" filter="url(#f12l3ty6aggeyv)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="102" x="529" y="60.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="84" x="535" y="77.0566">initialization</text><polygon fill="#A80036" points="363,111.1094,353,115.1094,363,119.1094,359,115.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="357" x2="632" y1="115.1094" y2="115.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="369" y="110.3672">starts</text><line style="stroke:#A80036;stroke-width:1.0;" x1="228.5" x2="238.5" y1="144.4199" y2="140.4199"/><line style="stroke:#A80036;stroke-width:1.0;" x1="228.5" x2="238.5" y1="144.4199" y2="148.4199"/><line style="stroke:#A80036;stroke-width:1.0;" x1="228.5" x2="351" y1="144.4199" y2="144.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="245.5" y="139.6777">starts</text><rect fill="#EEEEEE" filter="url(#f12l3ty6aggeyv)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1160" x="0" y="173.0752"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1160" y1="173.0752" y2="173.0752"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1160" y1="176.0752" y2="176.0752"/><rect fill="#EEEEEE" filter="url(#f12l3ty6aggeyv)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="170" x="495" y="162.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="152" x="501" y="178.9883">message consumption</text><path d="M30,202.7305 L104,202.7305 L104,209.7305 L94,219.7305 L30,219.7305 L30,202.7305 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="115.2422" style="stroke:#000000;stroke-width:2.0;" width="531.5" x="30" y="202.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="45" y="216.2988">loop</text><line style="stroke:#A80036;stroke-width:1.0;" x1="83.5" x2="93.5" y1="246.3516" y2="242.3516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="83.5" x2="93.5" y1="246.3516" y2="250.3516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="83.5" x2="227.5" y1="246.3516" y2="246.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="100.5" y="241.6094">asks for a message</text><path d="M233,225.041 L233,250.041 L542,250.041 L542,235.041 L532,225.041 L233,225.041 " fill="#FBFB77" filter="url(#f12l3ty6aggeyv)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M532,225.041 L532,235.041 L542,235.041 L532,225.041 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="288" x="239" y="242.6094">awaits consumed messages will be processed</text><line style="stroke:#A80036;stroke-width:1.0;" x1="226.5" x2="216.5" y1="280.6621" y2="276.6621"/><line style="stroke:#A80036;stroke-width:1.0;" x1="226.5" x2="216.5" y1="280.6621" y2="284.6621"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="83.5" x2="227.5" y1="280.6621" y2="280.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="90.5" y="275.9199">returns a message</text><polygon fill="#A80036" points="473,305.9727,483,309.9727,473,313.9727,477,309.9727" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="228.5" x2="479" y1="309.9727" y2="309.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="235.5" y="305.2305">pushes a message</text><rect fill="#EEEEEE" filter="url(#f12l3ty6aggeyv)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1160" x="0" y="345.6279"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1160" y1="345.6279" y2="345.6279"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1160" y1="348.6279" y2="348.6279"/><rect fill="#EEEEEE" filter="url(#f12l3ty6aggeyv)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="156" x="502" y="334.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="138" x="508" y="351.541">message processing</text><path d="M10,375.2832 L84,375.2832 L84,382.2832 L74,392.2832 L10,392.2832 L10,375.2832 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="562.5449" style="stroke:#000000;stroke-width:2.0;" width="1140" x="10" y="375.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="25" y="388.8516">loop</text><polygon fill="#A80036" points="644,409.9043,634,413.9043,644,417.9043,640,413.9043" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="638" x2="790" y1="413.9043" y2="413.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="650" y="409.1621">asks for a message</text><polygon fill="#A80036" points="496,439.2148,486,443.2148,496,447.2148,492,443.2148" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="490" x2="632" y1="443.2148" y2="443.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="502" y="438.4727">retrieves a message</text><polygon fill="#A80036" points="621,468.5254,631,472.5254,621,476.5254,625,472.5254" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="485" x2="627" y1="472.5254" y2="472.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="492" y="467.7832">returns a message</text><polygon fill="#A80036" points="779,497.8359,789,501.8359,779,505.8359,783,501.8359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="633" x2="785" y1="501.8359" y2="501.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="640" y="497.0938">returns a message</text><polygon fill="#A80036" points="977.5,527.1465,987.5,531.1465,977.5,535.1465,981.5,531.1465" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="791" x2="983.5" y1="531.1465" y2="531.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="798" y="526.4043">handles a message</text><path d="M20,546.1465 L82,546.1465 L82,553.1465 L72,563.1465 L20,563.1465 L20,546.1465 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="384.6816" style="stroke:#000000;stroke-width:2.0;" width="1120" x="20" y="546.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="35" y="559.7148">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="51" x="97" y="558.7813">[success]</text><polygon fill="#A80036" points="802,580.7676,792,584.7676,802,588.7676,798,584.7676" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="796" x2="988.5" y1="584.7676" y2="584.7676"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="808" y="580.0254">handles successful</text><polygon fill="#A80036" points="644,610.0781,634,614.0781,644,618.0781,640,614.0781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="638" x2="790" y1="614.0781" y2="614.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="650" y="609.3359">handles successful</text><polygon fill="#A80036" points="239.5,639.3887,229.5,643.3887,239.5,647.3887,235.5,643.3887" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="233.5" x2="632" y1="643.3887" y2="643.3887"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="245.5" y="638.6465">accepts a message</text><line style="stroke:#A80036;stroke-width:1.0;" x1="83.5" x2="93.5" y1="672.6992" y2="668.6992"/><line style="stroke:#A80036;stroke-width:1.0;" x1="83.5" x2="93.5" y1="672.6992" y2="676.6992"/><line style="stroke:#A80036;stroke-width:1.0;" x1="83.5" x2="227.5" y1="672.6992" y2="672.6992"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="100.5" y="667.957">accepts a message</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="1140" y1="681.6992" y2="681.6992"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="45" x="25" y="692.334">[failure]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="989.5" x2="1031.5" y1="716.9648" y2="716.9648"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1031.5" x2="1031.5" y1="716.9648" y2="729.9648"/><line style="stroke:#A80036;stroke-width:1.0;" x1="990.5" x2="1031.5" y1="729.9648" y2="729.9648"/><polygon fill="#A80036" points="1000.5,725.9648,990.5,729.9648,1000.5,733.9648,996.5,729.9648" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="996.5" y="712.2227">raises an exception</text><polygon fill="#A80036" points="802,755.2754,792,759.2754,802,763.2754,798,759.2754" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="796" x2="988.5" y1="759.2754" y2="759.2754"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="808" y="754.5332">excepts an exception</text><polygon fill="#A80036" points="644,784.5859,634,788.5859,644,792.5859,640,788.5859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="638" x2="790" y1="788.5859" y2="788.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="650" y="783.8438">excepts an exception</text><path d="M30,803.5859 L92,803.5859 L92,810.5859 L82,820.5859 L30,820.5859 L30,803.5859 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="120.2422" style="stroke:#000000;stroke-width:2.0;" width="705" x="30" y="803.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="45" y="817.1543">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="91" x="107" y="816.2207">[retry exception]</text><polygon fill="#A80036" points="239.5,838.207,229.5,842.207,239.5,846.207,235.5,842.207" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="233.5" x2="632" y1="842.207" y2="842.207"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="245.5" y="837.4648">rejects a message</text><line style="stroke:#A80036;stroke-width:1.0;" x1="83.5" x2="93.5" y1="871.5176" y2="867.5176"/><line style="stroke:#A80036;stroke-width:1.0;" x1="83.5" x2="93.5" y1="871.5176" y2="875.5176"/><line style="stroke:#A80036;stroke-width:1.0;" x1="83.5" x2="227.5" y1="871.5176" y2="871.5176"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="100.5" y="866.7754">rejects a message</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="30" x2="735" y1="880.5176" y2="880.5176"/><line style="stroke:#A80036;stroke-width:1.0;" x1="633" x2="675" y1="902.8281" y2="902.8281"/><line style="stroke:#A80036;stroke-width:1.0;" x1="675" x2="675" y1="902.8281" y2="915.8281"/><line style="stroke:#A80036;stroke-width:1.0;" x1="634" x2="675" y1="915.8281" y2="915.8281"/><polygon fill="#A80036" points="644,911.8281,634,915.8281,644,919.8281,640,915.8281" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="640" y="898.0859">stop working</text><!--MD5=[d39f0269c13ff1f0187600ee115ccd6a]
@startuml

queue "RabbitMQ" as mq
participant Consumer as consumer
participant "threading.Thread" as thread
queue "Internal FIFO" as imq
participant Receive
participant Application as app
participant "md.message.MessageHandlerInterface" as MessageHandler

== initialization ==

Receive -> thread : starts
thread ->> consumer : starts

== message consumption ==

loop
  consumer ->> mq : asks for a message
  note right
    awaits consumed messages will be processed
  end note

  mq - ->> consumer : returns a message
  consumer -> imq : pushes a message
end

== message processing ==

loop
  app -> Receive: asks for a message
  Receive -> imq : retrieves a message
  imq - -> Receive: returns a message
  Receive - -> app : returns a message
  app -> MessageHandler : handles a message

  alt success
    MessageHandler - -> app : handles successful
    app - -> Receive : handles successful
    Receive -> consumer : accepts a message
    consumer ->> mq : accepts a message
  else failure
    MessageHandler -> MessageHandler : raises an exception
    MessageHandler -> app : excepts an exception
    app -> Receive : excepts an exception

    alt retry exception
      Receive -> consumer : rejects a message
      consumer ->> mq : rejects a message
    else
      Receive -> Receive : stop working
    end
  end
end

@enduml

PlantUML version 1.2022.0(Tue Jan 11 19:16:42 MSK 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: ru
Country: RU
--></g></svg>